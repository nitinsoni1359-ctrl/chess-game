<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Grandmaster Pro Chess</title>
    <!-- Dependencies -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/chessboard-js/1.0.0/chessboard-1.0.0.min.css">
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/chess.js/0.10.3/chess.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/chessboard-js/1.0.0/chessboard-1.0.0.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        :root {
            --bg-dark: #0f172a;
            --board-border: #334155;
        }
        body {
            background-color: var(--bg-dark);
            color: white;
            font-family: 'Inter', system-ui, -apple-system, sans-serif;
            overflow-x: hidden;
        }
        .chessboard-63f30 { border: 4px solid var(--board-border); border-radius: 8px; box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.5); }
        .captured-pieces { min-height: 40px; }
        .scroll-custom::-webkit-scrollbar { width: 6px; }
        .scroll-custom::-webkit-scrollbar-thumb { background: #475569; border-radius: 10px; }
        
        /* Highlight for last move */
        .highlight-move {
            box-shadow: inset 0 0 3px 3px rgba(255, 255, 0, 0.5);
        }
    </style>
</head>
<body class="min-h-screen p-2 md:p-8 flex flex-col items-center">

    <div class="max-w-6xl w-full grid grid-cols-1 lg:grid-cols-3 gap-8">
        
        <!-- Left Column: Board -->
        <div class="lg:col-span-2 flex flex-col items-center">
            <div class="w-full flex justify-between items-center mb-6 px-2">
                <div>
                    <h1 class="text-3xl font-black tracking-tighter text-white">CHESS<span class="text-blue-500">PRO</span></h1>
                    <p class="text-xs text-slate-400 uppercase tracking-widest">v1.0 Stable</p>
                </div>
                <div id="game-status" class="bg-blue-600/20 text-blue-400 border border-blue-600/30 px-4 py-2 rounded-xl text-sm font-bold animate-pulse">
                    White to move
                </div>
            </div>

            <div id="board" class="w-full max-w-[550px]"></div>

            <div class="mt-8 w-full flex flex-wrap gap-3 justify-center">
                <button id="reset-btn" class="bg-red-500/10 hover:bg-red-500/20 text-red-500 border border-red-500/20 px-6 py-2 rounded-xl font-bold transition-all">New Game</button>
                <button id="undo-btn" class="bg-slate-700 hover:bg-slate-600 text-white px-6 py-2 rounded-xl font-bold transition-all">Undo</button>
                <select id="mode-select" class="bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded-xl font-bold outline-none cursor-pointer shadow-lg transition-all">
                    <option value="pvp">üë• Local Multiplayer</option>
                    <option value="ai-easy">ü§ñ AI (Easy)</option>
                    <option value="ai-med" selected>ü§ñ AI (Medium)</option>
                    <option value="ai-hard">ü§ñ AI (Hard)</option>
                </select>
            </div>
        </div>

        <!-- Right Column: Sidebar -->
        <div class="bg-slate-800/50 border border-slate-700/50 p-6 rounded-3xl shadow-2xl flex flex-col h-[650px] backdrop-blur-sm">
            <h2 class="text-xl font-bold mb-4 flex items-center gap-2">
                <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 text-blue-500" viewBox="0 0 20 20" fill="currentColor">
                    <path fill-rule="evenodd" d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a1 1 0 000 2v3a1 1 0 001 1h1a1 1 0 100-2v-3a1 1 0 00-1-1H9z" clip-rule="evenodd" />
                </svg>
                Match Analysis
            </h2>
            
            <div class="mb-6 space-y-4">
                <div>
                    <p class="text-slate-500 text-[10px] mb-2 uppercase tracking-widest font-black">Advantage: White</p>
                    <div id="captured-white" class="captured-pieces flex flex-wrap gap-1 text-2xl bg-slate-900/40 p-3 rounded-2xl border border-slate-700/30"></div>
                </div>
                <div>
                    <p class="text-slate-500 text-[10px] mb-2 uppercase tracking-widest font-black">Advantage: Black</p>
                    <div id="captured-black" class="captured-pieces flex flex-wrap gap-1 text-2xl bg-slate-900/40 p-3 rounded-2xl border border-slate-700/30"></div>
                </div>
            </div>

            <div class="flex-grow flex flex-col overflow-hidden">
                <p class="text-slate-500 text-[10px] mb-2 uppercase tracking-widest font-black">Move Log</p>
                <div id="move-history" class="bg-slate-900/60 border border-slate-700/30 rounded-2xl p-4 flex-grow overflow-y-auto scroll-custom font-mono text-xs">
                    <!-- Moves injected here -->
                </div>
            </div>

            <div class="mt-6 p-4 bg-blue-500/5 rounded-2xl border border-blue-500/10 flex items-center justify-between">
                <div>
                    <p class="text-[10px] text-slate-500 uppercase font-bold">Engine Status</p>
                    <p id="engine-status" class="text-xs text-green-400 font-medium italic">Idle</p>
                </div>
                <button onclick="copyURL()" class="text-blue-400 hover:text-blue-300 text-xs font-bold bg-blue-500/10 px-3 py-1 rounded-lg transition-colors">
                    Share Link
                </button>
            </div>
        </div>
    </div>

    <!-- Modals -->
    <div id="modal-overlay" class="hidden fixed inset-0 bg-slate-950/90 backdrop-blur-md flex items-center justify-center z-50">
        <div id="game-over-modal" class="bg-slate-800 border border-slate-700 p-8 rounded-[2rem] text-center max-w-sm w-full mx-4 shadow-2xl transition-all scale-95 opacity-0">
            <div class="w-20 h-20 bg-blue-600/20 rounded-full flex items-center justify-center mx-auto mb-6">
                <span class="text-4xl">üèÜ</span>
            </div>
            <h2 class="text-3xl font-black mb-2" id="modal-title">Game Over</h2>
            <p class="text-slate-400 mb-8" id="modal-body">White won by checkmate.</p>
            <button onclick="location.reload()" class="w-full bg-blue-600 hover:bg-blue-700 text-white py-4 rounded-2xl font-bold shadow-lg shadow-blue-900/20 transition-all active:scale-95">Play Again</button>
        </div>
    </div>

    <script>
        var board = null;
        var game = new Chess();
        var $status = $('#game-status');
        var $history = $('#move-history');
        var $capturedWhite = $('#captured-white');
        var $capturedBlack = $('#captured-black');

        // Material weights
        const pieceValues = { p: 10, n: 30, b: 30, r: 50, q: 90, k: 900 };

        // --- AI LOGIC (Minimax + Alpha-Beta) ---
        function evaluateBoard(game) {
            let totalEvaluation = 0;
            const board = game.board();
            for (let i = 0; i < 8; i++) {
                for (let j = 0; j < 8; j++) {
                    const piece = board[i][j];
                    if (piece) {
                        const val = pieceValues[piece.type];
                        totalEvaluation += (piece.color === 'w' ? val : -val);
                    }
                }
            }
            return totalEvaluation;
        }

        function minimax(game, depth, alpha, beta, isMaximizingPlayer) {
            if (depth === 0) return -evaluateBoard(game);

            const moves = game.moves();
            if (isMaximizingPlayer) {
                let bestEval = -9999;
                for (let move of moves) {
                    game.move(move);
                    bestEval = Math.max(bestEval, minimax(game, depth - 1, alpha, beta, false));
                    game.undo();
                    alpha = Math.max(alpha, bestEval);
                    if (beta <= alpha) break;
                }
                return bestEval;
            } else {
                let bestEval = 9999;
                for (let move of moves) {
                    game.move(move);
                    bestEval = Math.min(bestEval, minimax(game, depth - 1, alpha, beta, true));
                    game.undo();
                    beta = Math.min(beta, bestEval);
                    if (beta <= alpha) break;
                }
                return bestEval;
            }
        }

        function getBestMove(game) {
            const moves = game.moves();
            if (moves.length === 0) return null;
            
            let bestMove = null;
            let bestValue = -9999;
            
            const mode = $('#mode-select').val();
            const depth = mode === 'ai-easy' ? 1 : mode === 'ai-hard' ? 3 : 2;

            $('#engine-status').text('Thinking...').addClass('text-yellow-400').removeClass('text-green-400');

            for (let move of moves) {
                game.move(move);
                const boardValue = minimax(game, depth - 1, -10000, 10000, false);
                game.undo();
                if (boardValue > bestValue) {
                    bestValue = boardValue;
                    bestMove = move;
                }
            }

            $('#engine-status').text('Idle').addClass('text-green-400').removeClass('text-yellow-400');
            return bestMove;
        }

        // --- GAME HANDLERS ---
        function onDragStart(source, piece) {
            if (game.game_over()) return false;
            if ((game.turn() === 'w' && piece.search(/^b/) !== -1) ||
                (game.turn() === 'b' && piece.search(/^w/) !== -1)) return false;
            if ($('#mode-select').val().startsWith('ai-') && game.turn() === 'b') return false;
        }

        function onDrop(source, target) {
            const move = game.move({ from: source, to: target, promotion: 'q' });
            if (move === null) return 'snapback';

            updateStatus();
            if ($('#mode-select').val().startsWith('ai-') && !game.game_over()) {
                window.setTimeout(makeBestMove, 250);
            }
        }

        function makeBestMove() {
            const move = getBestMove(game);
            if (move) {
                game.move(move);
                board.position(game.fen());
                updateStatus();
            }
        }

        function updateStatus() {
            let status = game.turn() === 'w' ? 'White to move' : 'Black to move';
            if (game.in_checkmate()) {
                status = 'CHECKMATE';
                showGameOver('Checkmate!', (game.turn() === 'w' ? 'Black' : 'White') + ' has won the match.');
            } else if (game.in_draw()) {
                status = 'DRAW';
                showGameOver('Draw', 'The match ended in a stalemate.');
            } else if (game.in_check()) {
                status += ' (Check!)';
            }

            $status.html(status);
            updateMoveHistory();
            updateCapturedPieces();
        }

        function updateMoveHistory() {
            const history = game.history();
            $history.empty();
            for (let i = 0; i < history.length; i += 2) {
                $history.append(`
                    <div class="grid grid-cols-3 py-1.5 border-b border-slate-800 items-center">
                        <span class="text-slate-600 font-bold">${Math.floor(i/2)+1}.</span>
                        <span class="text-white font-medium">${history[i]}</span>
                        <span class="text-slate-400 text-right">${history[i+1] || ''}</span>
                    </div>
                `);
            }
            $history.scrollTop($history[0].scrollHeight);
        }

        const icons = {'wP':'‚ôô','wN':'‚ôò','wB':'‚ôó','wR':'‚ôñ','wQ':'‚ôï','wK':'‚ôî','bP':'‚ôü','bN':'‚ôû','bB':'‚ôù','bR':'‚ôú','bQ':'‚ôõ','bK':'‚ôö'};
        function updateCapturedPieces() {
            let w = '', b = '';
            game.history({verbose: true}).forEach(m => {
                if (m.captured) {
                    const icon = icons[m.color === 'w' ? 'b' + m.captured.toUpperCase() : 'w' + m.captured.toUpperCase()];
                    if (m.color === 'w') b += icon; else w += icon;
                }
            });
            $capturedWhite.html(w);
            $capturedBlack.html(b);
        }

        function showGameOver(title, body) {
            $('#modal-title').text(title);
            $('#modal-body').text(body);
            $('#modal-overlay').removeClass('hidden');
            setTimeout(() => $('#game-over-modal').removeClass('scale-95 opacity-0').addClass('scale-100 opacity-100'), 50);
        }

        function copyURL() {
            const el = document.createElement('textarea');
            el.value = window.location.href;
            document.body.appendChild(el);
            el.select();
            document.execCommand('copy');
            document.body.removeChild(el);
            $('#engine-status').text('URL Copied!').addClass('text-blue-400');
            setTimeout(() => $('#engine-status').text('Idle').removeClass('text-blue-400'), 2000);
        }

        // --- INIT ---
        board = Chessboard('board', {
            draggable: true,
            position: 'start',
            onDragStart: onDragStart,
            onDrop: onDrop,
            onSnapEnd: () => board.position(game.fen()),
            pieceTheme: 'https://chessboardjs.com/img/chesspieces/wikipedia/{piece}.png'
        });

        $(window).resize(() => board.resize());
        $('#reset-btn').click(() => location.reload());
        $('#undo-btn').click(() => {
            game.undo();
            if ($('#mode-select').val().startsWith('ai-')) game.undo();
            board.position(game.fen());
            updateStatus();
        });

        updateStatus();
    </script>
</body>
</html>
